<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hóa Học Lớp 9: Bài Giảng Hợp Chất Hữu Cơ (Thầy Lâm)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom Tailwind Configuration */
        :root {
            --primary-green: #10B981; /* Emerald 500 */
            --secondary-yellow: #FACC15; /* Yellow 400 */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            scroll-behavior: smooth;
        }

        /* Custom Styles for Buttons */
        .btn-primary-cta {
            /* Pill shape, Gradient, Shadow, Hover effect */
            background-image: linear-gradient(to right, #34D399 0%, #059669 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px 0 rgba(16, 185, 129, 0.75);
        }
        .btn-primary-cta:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px 0 rgba(16, 185, 129, 0.9);
        }

        .btn-secondary {
            /* Rounded rectangle, solid color, hover effect */
            background-color: var(--primary-green);
            transition: background-color 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .btn-secondary:hover {
            background-color: #059669; /* Darker green */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* Tab Card Lift Effect */
        .quiz-option-card {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .quiz-option-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }
        /* Specific state colors (example for quiz, although we use iframe) */
        .correct { background-color: #D1FAE5; } /* Green-50 */
        .incorrect { background-color: #FEE2E2; } /* Red-50 */
        .normal { background-color: #F3F4F6; } /* Gray-100 */

        /* Responsive Iframe for Quiz */
        .iframe-container {
            width: 100%;
            /* Adjust height for mobile header (approx 56px) + padding */
            height: calc(100vh - 120px); 
            min-height: 500px;
        }

        /* Sidebar specific styles for desktop: Fixed position and relative flow */
        @media (min-width: 768px) {
            #sidebar-nav {
                position: relative; /* Change from fixed/absolute to flow with flex parent */
                transform: translateX(0) !important; /* Ensure it's always visible on desktop */
                flex-shrink: 0;
            }
            #main-content > .flex {
                /* Create the desktop flex layout */
                display: flex;
            }
        }
    </style>

    <!-- MathJax Configuration -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            /* Đã loại bỏ custom renderActions gây ra TypeError */
            loader: {
                load: ['input/tex', 'output/chtml', 'ui/menu']
            },
            chtml: {
                scale: 1.05 /* Slightly larger for better mobile readability */
            }
        };
    </script>
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body class="bg-gray-50">

    <!-- 1. SPLASH SCREEN (Bìa Sách) -->
    <div id="splash-screen" class="fixed inset-0 flex flex-col items-center justify-center p-8 text-white z-50 transition-opacity duration-1000" style="background-image: linear-gradient(135deg, #16a34a 0%, #65a30d 100%);">
        <div class="max-w-4xl text-center p-8 bg-white/10 backdrop-blur-sm rounded-3xl shadow-2xl">
            <p class="text-xl sm:text-2xl font-semibold mb-4 text-yellow-300">Hóa Học Lớp 9</p>
            <h1 class="text-4xl sm:text-6xl font-extrabold mb-8 leading-tight">
                HỢP CHẤT HỮU CƠ: <br class="sm:hidden">
                <span class="text-yellow-400 block sm:inline-block mt-2">NGỤ NGÔN CỦA NGUYÊN TỐ CARBON</span>
            </h1>
            <p class="text-lg sm:text-xl italic mb-10 opacity-90">
                Bài giảng được biên soạn bởi: <span class="font-bold">Thầy Lâm</span>
            </p>
            <button id="start-learning-btn" class="btn-primary-cta text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg">
                BẮT ĐẦU HỌC NGAY
            </button>
        </div>
    </div>

    <!-- 2. MAIN APPLICATION CONTAINER -->
    <div id="main-content" class="hidden min-h-screen">
        
        <!-- MOBILE HEADER (Visible on Mobile to hold the title and hamburger) -->
        <header class="sticky top-0 bg-white shadow-md z-30 p-4 flex justify-between items-center md:hidden">
            <div class="text-xl font-bold text-green-700">Hóa Hữu Cơ | Lớp 9</div>
            <button id="menu-toggle-btn" class="text-green-600 p-1 rounded-full hover:bg-green-100 transition">
                <!-- Hamburger Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
        </header>

        <!-- FLEX CONTAINER FOR DESKTOP LAYOUT -->
        <div class="md:flex min-h-screen">
            
            <!-- SIDEBAR NAVIGATION (Slide-in on Mobile, Fixed/Flow on Desktop) -->
            <!-- Mobile: fixed, full height, z-50, hidden by default (-translate-x-full) -->
            <nav id="sidebar-nav" class="fixed top-0 bottom-0 left-0 z-50 w-60 bg-white shadow-xl transform transition-transform duration-300 ease-in-out 
                                        -translate-x-full md:translate-x-0 md:w-60 md:shadow-lg md:z-auto md:block 
                                        p-4 md:p-6 overflow-y-auto">
                <!-- Title/Logo for Sidebar (Desktop) -->
                <div class="text-2xl font-extrabold text-green-700 mb-6 border-b pb-2 border-yellow-300">
                    <span class="text-green-500">Thầy Lâm</span> | Hữu Cơ
                </div>

                <!-- Tabs Container -->
                <div id="tabs-container" class="space-y-3">
                    <!-- Tabs will be rendered here by JS -->
                </div>
            </nav>

            <!-- CONTENT AREA WRAPPER -->
            <div class="flex-1 min-h-screen md:pt-4">
                <!-- Content will appear next to sidebar on desktop -->
                <main class="container mx-auto p-4 sm:p-8">
                    <div id="tab-content-area" class="bg-white rounded-xl shadow-lg p-6 sm:p-10 min-h-[60vh] max-w-4xl mx-auto md:max-w-full">
                        <!-- Content will be injected here -->
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- JavaScript for Logic, Tab Switching, and SVGs -->
    <script>
        const tabsData = [
            { id: 'intro', name: 'Giới thiệu', active: true },
            { id: 'definition', name: 'Định nghĩa, Cấu tạo' },
            { id: 'bonding', name: 'Liên kết, Đồng phân' },
            { id: 'properties', name: 'Tính chất Hóa học' },
            { id: 'quiz', name: 'Kiểm tra' }
        ];

        let isSidebarOpen = false;

        // --- Utility Functions ---

        /**
         * Chuyển đổi ID tab thành tiêu đề thân thiện
         */
        function getTabTitle(id) {
            const tab = tabsData.find(t => t.id === id);
            return tab ? tab.name : 'Nội dung';
        }

        /**
         * Xử lý đóng/mở sidebar trên mobile
         */
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar-nav');
            const toggleBtn = document.getElementById('menu-toggle-btn');
            const closeIcon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>';
            const menuIcon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>';

            isSidebarOpen = !isSidebarOpen;
            
            if (isSidebarOpen) {
                sidebar.classList.remove('-translate-x-full');
                sidebar.classList.add('translate-x-0');
                toggleBtn.innerHTML = closeIcon;
            } else {
                sidebar.classList.remove('translate-x-0');
                sidebar.classList.add('-translate-x-full');
                toggleBtn.innerHTML = menuIcon;
            }
        }

        /**
         * Xử lý chuyển đổi tab
         */
        function switchTab(tabId) {
            tabsData.forEach(tab => {
                tab.active = tab.id === tabId;
            });
            renderTabs();
            renderContent(tabId);

            // Đóng sidebar nếu đang mở trên thiết bị mobile
            if (window.innerWidth < 768 && isSidebarOpen) {
                toggleSidebar();
            }
        }

        /**
         * Kích hoạt MathJax sau khi nội dung được render
         * NOTE: MathJax.typesetPromise([contentElement]) là cách gọi đúng cho nội dung dynamic
         */
        function typesetMath() {
            if (window.MathJax) {
                const contentElement = document.getElementById('tab-content-area');
                // Sử dụng Typeset function để xử lý lại nội dung toán học mới
                window.MathJax.typesetPromise([contentElement]).catch(err => console.error("MathJax Typeset Error:", err));
            }
        }

        // --- Rendering Functions ---

        /**
         * Render các nút tab điều hướng
         */
        function renderTabs() {
            const tabsContainer = document.getElementById('tabs-container');
            // Classes cho sidebar: chiếm toàn bộ chiều rộng và căn lề trái
            const baseClasses = 'py-2 px-4 rounded-lg font-medium text-base transition duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 block w-full text-left';
            const activeClasses = 'bg-green-600 text-white shadow-md focus:ring-green-500';
            const inactiveClasses = 'bg-gray-100 text-gray-700 hover:bg-green-100 hover:text-green-600 focus:ring-green-300';
            
            tabsContainer.innerHTML = tabsData.map(tab => {
                const classes = tab.active ? activeClasses : inactiveClasses;

                return `
                    <button onclick="switchTab('${tab.id}')" class="${baseClasses} ${classes}">
                        ${tab.name}
                    </button>
                `;
            }).join('');
        }

        /**
         * Render nội dung cho tab đang hoạt động
         */
        function renderContent(tabId) {
            const contentArea = document.getElementById('tab-content-area');
            let htmlContent = '';
            let svgSimulation = '';
            const title = getTabTitle(tabId);

            switch (tabId) {
                case 'intro':
                    htmlContent = `
                        <h2 class="text-3xl font-bold text-green-700 mb-6 border-b-2 border-yellow-400 pb-2">${title}</h2>
                        <div class="space-y-6 text-gray-700 text-lg">
                            <p>Chào các em, thầy là Thầy Lâm. Hôm nay chúng ta sẽ cùng nhau khám phá một vương quốc mới của Hóa học, nơi mà sự sống được kiến tạo - Vương quốc của Hợp chất hữu cơ.</p>
                            
                            <p class="p-4 bg-green-50 border-l-4 border-green-400 italic rounded-lg">
                                Thầy muốn kể cho các em nghe câu chuyện về **Người Thợ Gốm Carbon**. Trong thế giới nguyên tố, Carbon không phải là kẻ mạnh nhất, nhưng nó là người thợ gốm khéo léo nhất. Nó có bốn cánh tay, không bao giờ dùng hết sức để giữ một món đồ, mà luôn tìm cách nắm tay bốn người bạn khác, tạo nên những chuỗi, những vòng, những hình thù phức tạp mà không một nguyên tố nào sánh kịp. Nhờ sự linh hoạt và khả năng kết nối không giới hạn này, nó đã tạo ra hàng triệu món đồ vật (hợp chất) khác nhau, từ chiếc lá xanh cho đến chính cơ thể chúng ta.
                            </p>
                            
                            <p>Đây là hành trình khám phá khả năng liên kết tuyệt vời của Carbon, các em hãy sẵn sàng nhé!</p>
                        </div>
                        <div class="mt-8">
                            <h3 class="text-xl font-semibold text-green-600 mb-3">Tóm tắt Bài Giảng</h3>
                            <ul class="list-disc pl-5 space-y-2">
                                <li><strong>Mục tiêu:</strong> Hiểu được định nghĩa, cấu trúc, các loại liên kết và tính chất cơ bản của hợp chất hữu cơ.</li>
                                <li><strong>Yêu cầu:</strong> Hoàn thành 3 phần nội dung và làm bài kiểm tra cuối cùng.</li>
                            </ul>
                        </div>
                    `;
                    break;
                case 'definition':
                    svgSimulation = `
                        <svg id="svg-carbon-structure" viewBox="0 0 400 200" class="w-full h-48 bg-gray-50 rounded-lg shadow-inner mt-6"></svg>
                    `;
                    htmlContent = `
                        <h2 class="text-3xl font-bold text-green-700 mb-6 border-b-2 border-yellow-400 pb-2">${title}</h2>
                        <div class="space-y-5 text-gray-700 text-lg">
                            <h3 class="text-xl font-semibold text-green-600">1. Định nghĩa cơ bản</h3>
                            <p><strong>Hợp chất hữu cơ</strong> là các hợp chất của Carbon (trừ $CO$, $CO_2$, muối carbonat, cyanua...). Đặc trưng của chúng là luôn có nguyên tố Carbon và thường có Hydrogen.</p>
                            
                            <h3 class="text-xl font-semibold text-green-600">2. Cấu tạo (Hóa trị và Liên kết)</h3>
                            <p>Nguyên tố Carbon có hóa trị **IV** và luôn thể hiện khả năng liên kết đa dạng:</p>
                            <div class="math-content p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded-lg">
                                <p><strong>Quy tắc hóa trị:</strong> Carbon luôn có 4 gạch liên kết. Hydrogen luôn có 1 gạch liên kết.</p>
                                <p>Ví dụ: Công thức cấu tạo của Methane ($CH_4$) - một hợp chất hữu cơ đơn giản:</p>
                                $$
                                \\text{H} - \\underset{\\text{H}}{\\overset{\\text{H}}{\\text{C}}} - \\text{H}
                                $$
                            </div>
                            <p>Các nguyên tử Carbon có thể liên kết với nhau tạo thành các <strong>Mạch Carbon</strong> (mạch thẳng, mạch nhánh, mạch vòng). Đây chính là "bộ xương" của các hợp chất hữu cơ.</p>
                        </div>
                        ${svgSimulation}
                    `;
                    break;
                case 'bonding':
                    svgSimulation = `
                        <svg id="svg-isomerism" viewBox="0 0 400 250" class="w-full h-64 bg-gray-50 rounded-lg shadow-inner mt-6"></svg>
                    `;
                    htmlContent = `
                        <h2 class="text-3xl font-bold text-green-700 mb-6 border-b-2 border-yellow-400 pb-2">${title}</h2>
                        <div class="space-y-5 text-gray-700 text-lg">
                            <h3 class="text-xl font-semibold text-green-600">1. Các loại Liên kết</h3>
                            <p>Carbon có thể liên kết với Carbon hoặc các nguyên tử khác bằng:</p>
                            <ul class="list-disc pl-5 space-y-2">
                                <li><strong>Liên kết đơn:</strong> Chỉ một cặp electron chung. Ví dụ: Alkane.</li>
                                <li><strong>Liên kết đôi:</strong> Hai cặp electron chung. Ví dụ: Alkene.</li>
                                <li><strong>Liên kết ba:</strong> Ba cặp electron chung. Ví dụ: Alkyne.</li>
                            </ul>
                            <div class="math-content p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded-lg">
                                $$
                                \\text{C} - \\text{C} \\quad (\\text{Đơn}); \\quad \\text{C} = \\text{C} \\quad (\\text{Đôi}); \\quad \\text{C} \\equiv \\text{C} \\quad (\\text{Ba})
                                $$
                            </div>

                            <h3 class="text-xl font-semibold text-green-600">2. Hiện tượng Đồng phân</h3>
                            <p>Hiện tượng mà các hợp chất có cùng công thức phân tử ($C_xH_y...$) nhưng lại có cấu tạo và tính chất khác nhau. Đây là minh chứng cho sự linh hoạt của Người Thợ Gốm Carbon.</p>
                            <p>Ví dụ: $C_4H_{10}$ có 2 đồng phân (Butane và Isobutane).</p>
                        </div>
                        ${svgSimulation}
                    `;
                    break;
                case 'properties':
                    svgSimulation = `
                        <svg id="svg-combustion" viewBox="0 0 400 200" class="w-full h-48 bg-gray-50 rounded-lg shadow-inner mt-6"></svg>
                    `;
                    htmlContent = `
                        <h2 class="text-3xl font-bold text-green-700 mb-6 border-b-2 border-yellow-400 pb-2">${title}</h2>
                        <div class="space-y-5 text-gray-700 text-lg">
                            <h3 class="text-xl font-semibold text-green-600">1. Tính chất vật lý chung</h3>
                            <p>Đa số không tan hoặc ít tan trong nước, nhưng tan tốt trong các dung môi hữu cơ. Thường dễ bay hơi và dễ cháy.</p>

                            <h3 class="text-xl font-semibold text-green-600">2. Tính chất hóa học tiêu biểu</h3>
                            <p>Phần lớn các hợp chất hữu cơ đều có chung phản ứng **Đốt cháy** (Phản ứng với $O_2$):</p>
                            <div class="math-content p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded-lg">
                                <p><strong>Phản ứng đốt cháy:</strong> Khi đốt cháy hoàn toàn một hợp chất hữu cơ (chứa C, H, O), sản phẩm luôn là Carbon Dioxide ($CO_2$) và Nước ($H_2O$).</p>
                                $$
                                C_xH_yO_z + (x + \\frac{y}{4} - \\frac{z}{2})O_2 \\xrightarrow{t^o} xCO_2 + \\frac{y}{2}H_2O
                                $$
                            </div>
                            <p>Ví dụ: Đốt cháy Methane ($CH_4$):</p>
                            <div class="math-content p-3 bg-green-50 border rounded-lg">
                                $$
                                CH_4 + 2O_2 \\xrightarrow{t^o} CO_2 + 2H_2O
                                $$
                            </div>
                            <p>Các tính chất khác bao gồm: phản ứng cộng (thường với liên kết đôi/ba) và phản ứng thế (thường với liên kết đơn).</p>
                        </div>
                        ${svgSimulation}
                    `;
                    break;
                case 'quiz':
                    htmlContent = `
                        <h2 class="text-3xl font-bold text-green-700 mb-4 border-b-2 border-yellow-400 pb-2">${title}</h2>
                        <p class="text-gray-700 mb-4">
                            Đã đến lúc kiểm tra lại kiến thức. Các em hãy làm bài trắc nghiệm dưới đây. Bài kiểm tra này giúp các em củng cố lại khả năng nhận biết và phân tích các dạng hợp chất hữu cơ.
                        </p>
                        <!-- Iframe for the Quiz -->
                        <div class="iframe-container overflow-hidden rounded-lg shadow-xl border border-gray-200">
                            <iframe src="https://chem9-20251028.netlify.app/" title="Bài kiểm tra Hóa Học" class="w-full h-full border-0"></iframe>
                        </div>
                        <p class="text-sm text-gray-500 mt-4 italic text-center">
                            *Bài kiểm tra được nhúng từ nguồn bên ngoài.
                        </p>
                    `;
                    break;
            }

            // Clear and set new content
            contentArea.innerHTML = htmlContent;

            // Append SVG simulation area if it exists
            if (svgSimulation) {
                contentArea.insertAdjacentHTML('beforeend', svgSimulation);
                // Run specific SVG initialization function
                if (tabId === 'definition') initCarbonStructureSVG();
                if (tabId === 'bonding') initIsomerismSVG();
                if (tabId === 'properties') initCombustionSVG();
            }

            // Re-render math content after new HTML is injected
            typesetMath();
        }

        // --- SVG/Animation Functions ---

        /**
         * Tab 'Định nghĩa, Cấu tạo': Mô phỏng Carbon tạo 4 liên kết
         */
        function initCarbonStructureSVG() {
            const svg = document.getElementById('svg-carbon-structure');
            if (!svg) return;
            svg.innerHTML = ''; // Clear previous content

            const width = 400;
            const height = 200;
            const cx = width / 2;
            const cy = height / 2;

            // C (Carbon) - Green
            const carbon = createCircle(cx, cy, 30, '#10B981');
            carbon.setAttribute('data-id', 'C');
            const carbonText = createText(cx, cy + 5, 'C', '#FFFFFF', 18);
            svg.appendChild(carbon);
            svg.appendChild(carbonText); // Draw Carbon first

            // H (Hydrogen) - Yellow/White
            const hRadius = 15;
            const hColor = '#FACC15';
            const distance = 80;

            const atomsData = [
                { id: 'H1', angle: 0, x: cx + distance, y: cy, color: hColor },
                { id: 'H2', angle: 90, x: cx, y: cy - distance, color: hColor },
                { id: 'H3', angle: 180, x: cx - distance, y: cy, color: hColor },
                { id: 'H4', angle: 270, x: cx, y: cy + distance, color: hColor },
            ];

            const bonds = [];
            const hydrogens = [];

            // Create all elements but keep them hidden initially
            atomsData.forEach(atom => {
                // Bond Line
                const line = createLine(cx, cy, atom.x, atom.y, '#374151');
                line.setAttribute('stroke-dasharray', '0, 100');
                line.style.transition = 'stroke-dasharray 1s ease-out';
                bonds.push(line);
                svg.appendChild(line);

                // Hydrogen Atom Group (Circle and Text)
                const hCircle = createCircle(atom.x, atom.y, hRadius, atom.color);
                const hText = createText(atom.x, atom.y + 5, 'H', '#374151', 14);
                
                const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                group.setAttribute('opacity', '0');
                group.style.transition = 'opacity 0.5s ease-in';
                
                group.appendChild(hCircle);
                group.appendChild(hText);
                hydrogens.push(group);
                svg.appendChild(group);
            });

            // Animation sequence (Staggered draw)
            let delay = 500;
            const step = 500;

            bonds.forEach((bond, index) => {
                setTimeout(() => {
                    // 1. Draw the bond line
                    bond.setAttribute('stroke-dasharray', `${distance} ${distance}`);
                }, delay);
                
                setTimeout(() => {
                    // 2. Fade in the Hydrogen atom group
                    hydrogens[index].setAttribute('opacity', '1');
                }, delay + step);
                
                delay += (step * 2); // Increase delay for the next atom
            });

            // Final message
            setTimeout(() => {
                const message = createText(cx, cy + 80, 'Carbon: Hóa trị IV đã hoàn thành 4 liên kết', '#10B981', 16);
                message.setAttribute('opacity', '0');
                message.style.transition = 'opacity 1s ease-in';
                svg.appendChild(message);
                
                setTimeout(() => {
                    message.setAttribute('opacity', '1');
                }, 100);
            }, delay + 1000);
        }


        /**
         * Tab 'Liên kết, Đồng phân': Mô phỏng chuyển đổi đồng phân (Butane <-> Isobutane)
         */
        function initIsomerismSVG() {
            const svg = document.getElementById('svg-isomerism');
            if (!svg) return;
            
            // 1. Dùng createElementNS để tạo các phần tử <text> và gắn vào SVG trước khi gọi toggleIsomer
            const isomerLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            isomerLabel.setAttribute('x', '100');
            isomerLabel.setAttribute('y', '70');
            isomerLabel.setAttribute('class', 'text-sm font-semibold fill-green-700');
            
            const isomerLabel2 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            isomerLabel2.setAttribute('x', '100');
            isomerLabel2.setAttribute('y', '190');
            isomerLabel2.setAttribute('class', 'text-sm font-semibold fill-green-700');
            
            svg.innerHTML = `
                <text x="50" y="20" class="text-sm font-semibold fill-gray-600">Mô phỏng Đồng phân (C4H10)</text>
            `;

            svg.appendChild(isomerLabel);
            svg.appendChild(isomerLabel2);


            const cColor = '#10B981'; // Carbon
            const hColor = '#FACC15'; // Hydrogen

            // Butane (Chain) positions
            const butaneC = [
                { x: 100, y: 100 },
                { x: 150, y: 100 },
                { x: 200, y: 100 },
                { x: 250, y: 100 }
            ];

            // Isobutane (Branched) positions
            const isobutaneC = [
                { x: 150, y: 150 }, // C1
                { x: 200, y: 150 }, // C2 (Center)
                { x: 250, y: 150 }, // C3
                { x: 200, y: 100 }  // C4 (Branch)
            ];

            const elements = [];

            // Draw initial Butane chain
            for (let i = 0; i < 4; i++) {
                // Carbon atom (initial position: butane)
                const c = createCircle(butaneC[i].x, butaneC[i].y, 10, cColor);
                c.setAttribute('class', 'carbon-atom');
                c.setAttribute('data-index', i);
                elements.push(c);

                // Bond lines (initial: butane)
                if (i < 3) {
                    const line = createLine(butaneC[i].x, butaneC[i].y, butaneC[i+1].x, butaneC[i+1].y, '#374151');
                    line.setAttribute('class', 'bond-line');
                    elements.push(line);
                }
            }

            elements.forEach(el => svg.appendChild(el));

            let isButane = true;

            // Function to interpolate positions
            function animateTransition(startPos, endPos, duration, stepCallback, finishCallback) {
                const startTime = performance.now();
                function step(timestamp) {
                    const elapsed = timestamp - startTime;
                    const progress = Math.min(elapsed / duration, 1);

                    const currentPos = startPos.map((start, i) => ({
                        x: start.x + (endPos[i].x - start.x) * progress,
                        y: start.y + (endPos[i].y - start.y) * progress
                    }));

                    stepCallback(currentPos);

                    if (progress < 1) {
                        requestAnimationFrame(step);
                    } else {
                        finishCallback();
                    }
                }
                requestAnimationFrame(step);
            }

            function updateSVG(currentPos) {
                // Update Carbon positions
                const carbonAtoms = svg.querySelectorAll('.carbon-atom');
                carbonAtoms.forEach((c, i) => {
                    c.setAttribute('cx', currentPos[i].x);
                    c.setAttribute('cy', currentPos[i].y);
                });

                // Update Bond positions
                const bondLines = svg.querySelectorAll('.bond-line');
                bondLines.forEach((line, i) => {
                    line.setAttribute('x1', currentPos[i].x);
                    line.setAttribute('y1', currentPos[i].y);
                    // This logic only works for C-C bonds in sequence: C1-C2, C2-C3, C3-C4
                    if (i < 3) {
                        line.setAttribute('x2', currentPos[i+1].x);
                        line.setAttribute('y2', currentPos[i+1].y);
                    }
                });
            }

            // 2. Chỉnh sửa toggleIsomer để dùng các biến cục bộ đã được định nghĩa
            function toggleIsomer() {
                const start = isButane ? butaneC : isobutaneC;
                const end = isButane ? isobutaneC : butaneC;

                // Sử dụng các biến cục bộ thay vì document.getElementById
                isomerLabel.textContent = isButane ? 'Chuyển đổi...' : 'Chuyển đổi...';
                isomerLabel2.textContent = '';

                animateTransition(start, end, 1500, updateSVG, () => {
                    isButane = !isButane;
                    // Cập nhật text content sau khi hoàn thành chuyển đổi
                    isomerLabel.textContent = isButane ? '1. Butane (Mạch Thẳng)' : '2. Isobutane (Mạch Nhánh)';
                    isomerLabel2.textContent = isButane ? '' : 'Butane và Isobutane là đồng phân của nhau.';
                    setTimeout(toggleIsomer, 3000); // Repeat every 3 seconds
                });
            }

            toggleIsomer();
        }

        /**
         * Tab 'Tính chất Hóa học': Mô phỏng phản ứng Đốt cháy Methane
         */
        function initCombustionSVG() {
            const svg = document.getElementById('svg-combustion');
            if (!svg) return;
            svg.innerHTML = `
                <text x="50" y="20" class="text-sm font-semibold fill-gray-600">Mô phỏng Phản ứng Đốt cháy Methane: CH4 + 2O2 → CO2 + 2H2O</text>
            `;

            const cColor = '#3B82F6'; // Blue for C
            const oColor = '#EF4444'; // Red for O
            const hColor = '#FACC15'; // Yellow for H

            const molecules = [];

            // Helper to create Methane (CH4) elements
            function createMethane(cx, cy, scale) {
                const c = createCircle(cx, cy, 10 * scale, cColor);
                const h1 = createCircle(cx + 15 * scale, cy, 6 * scale, hColor);
                const h2 = createCircle(cx - 15 * scale, cy, 6 * scale, hColor);
                const h3 = createCircle(cx, cy + 15 * scale, 6 * scale, hColor);
                const h4 = createCircle(cx, cy - 15 * scale, 6 * scale, hColor);
                return [c, h1, h2, h3, h4];
            }

            // Helper to create Oxygen (O2) elements
            function createOxygen(cx, cy, scale) {
                const o1 = createCircle(cx - 7 * scale, cy, 8 * scale, oColor);
                const o2 = createCircle(cx + 7 * scale, cy, 8 * scale, oColor);
                // Draw a double bond line (optional for simplicity)
                const line = createLine(cx - 7 * scale + 5, cy, cx + 7 * scale - 5, cy, '#374151', 2);
                return [line, o1, o2];
            }

            // Helper to create CO2 (Linear)
            function createCO2(cx, cy, scale) {
                const c = createCircle(cx, cy, 10 * scale, cColor);
                const o1 = createCircle(cx - 20 * scale, cy, 8 * scale, oColor);
                const o2 = createCircle(cx + 20 * scale, cy, 8 * scale, oColor);
                const line1 = createLine(cx - 10 * scale + 2, cy, cx - 20 * scale + 8, cy, '#374151', 2);
                const line2 = createLine(cx + 10 * scale - 2, cy, cx + 20 * scale - 8, cy, '#374151', 2);
                return [line1, line2, c, o1, o2];
            }

            // Helper to create H2O (Bent)
            function createH2O(cx, cy, scale) {
                const o = createCircle(cx, cy, 8 * scale, oColor);
                const h1 = createCircle(cx - 10 * scale, cy + 10 * scale, 6 * scale, hColor);
                const h2 = createCircle(cx + 10 * scale, cy + 10 * scale, 6 * scale, hColor);
                return [o, h1, h2];
            }

            // Draw Reactants (Methane + 2 Oxygen)
            molecules.push(...createMethane(100, 100, 1));
            molecules.push(...createOxygen(200, 75, 1));
            molecules.push(...createOxygen(200, 125, 1));

            // Set initial positions and styles
            molecules.forEach(el => {
                el.style.transition = 'all 2s ease-in-out';
                svg.appendChild(el);
            });

            // Animation: The reaction (break and reform)
            setTimeout(() => {
                // Fade out reactants (simplification for bond breaking)
                molecules.forEach(el => {
                    el.style.opacity = 0;
                });

                // Clear SVG after fade out
                setTimeout(() => {
                    // Cần tạo lại element text cho phản ứng sau khi clear innerHTML
                    const reactionSign = createText(175, 100, '→ Đốt cháy...', '#DC2626', 24);
                    reactionSign.setAttribute('id', 'reaction-sign');
                    svg.innerHTML = `
                        <text x="50" y="20" class="text-sm font-semibold fill-gray-600">Mô phỏng Phản ứng Đốt cháy Methane: CH4 + 2O2 → CO2 + 2H2O</text>
                    `;
                    svg.appendChild(reactionSign);


                    // Draw Products (CO2 + 2 H2O) and animate entrance
                    setTimeout(() => {
                        const products = [];
                        // CO2
                        products.push(...createCO2(250, 100, 1));
                        // 2 H2O
                        products.push(...createH2O(350, 60, 1));
                        products.push(...createH2O(350, 140, 1));

                        // Hide 'Đốt cháy...'
                        reactionSign.style.transition = 'opacity 0.5s ease-out';
                        reactionSign.style.opacity = 0;

                        products.forEach(el => {
                            el.style.opacity = 0; // Start hidden
                            svg.appendChild(el);
                            // Animate fade in
                            setTimeout(() => {
                                el.style.transition = 'opacity 1s ease-in';
                                el.style.opacity = 1;
                            }, 100);
                        });

                    }, 2000); // 1s fade out + 1s delay

                }, 1000);
            }, 3000); // Start reaction after 3 seconds of viewing reactants

            // --- SVG Helper Primitives ---
            function createCircle(cx, cy, r, fill) {
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', cx);
                circle.setAttribute('cy', cy);
                circle.setAttribute('r', r);
                circle.setAttribute('fill', fill);
                return circle;
            }
            function createLine(x1, y1, x2, y2, stroke, strokeWidth = 1) {
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', x1);
                line.setAttribute('y1', y1);
                line.setAttribute('x2', x2);
                line.setAttribute('y2', y2);
                line.setAttribute('stroke', stroke);
                line.setAttribute('stroke-width', strokeWidth);
                line.setAttribute('stroke-linecap', 'round');
                return line;
            }
        }


        // --- General SVG Helper Primitives (Reusable) ---
        function createCircle(cx, cy, r, fill) {
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('cx', cx);
            circle.setAttribute('cy', cy);
            circle.setAttribute('r', r);
            circle.setAttribute('fill', fill);
            return circle;
        }
        function createText(x, y, text, fill, fontSize) {
            const t = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            t.setAttribute('x', x);
            t.setAttribute('y', y);
            t.setAttribute('fill', fill);
            t.setAttribute('text-anchor', 'middle');
            t.setAttribute('font-size', fontSize);
            t.setAttribute('font-weight', 'bold');
            t.textContent = text;
            return t;
        }
        function createLine(x1, y1, x2, y2, stroke, strokeWidth = 2) {
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', x1);
            line.setAttribute('y1', y1);
            line.setAttribute('x2', x2);
            line.setAttribute('y2', y2);
            line.setAttribute('stroke', stroke);
            line.setAttribute('stroke-width', strokeWidth);
            line.setAttribute('stroke-linecap', 'round');
            return line;
        }


        // --- Initialization ---

        function initApp() {
            // Event listener for the start button
            document.getElementById('start-learning-btn').addEventListener('click', () => {
                document.getElementById('splash-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('splash-screen').classList.add('hidden');
                    document.getElementById('main-content').classList.remove('hidden');
                }, 1000);
            });

            // Attach listener for the mobile menu toggle button
            document.getElementById('menu-toggle-btn').addEventListener('click', toggleSidebar);

            // Initial rendering of tabs and content
            renderTabs();
            renderContent(tabsData.find(t => t.active).id);
        }

        window.onload = initApp;

        // Make functions globally accessible for event handlers
        window.switchTab = switchTab;
    </script>

</body>
</html>
